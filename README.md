# ç‰ç±³ç²’åˆ†ç±»é¡¹ç›® (CornProject)

åŸºäºæ·±åº¦å­¦ä¹ çš„ç‰ç±³ç²’å®Œæ•´æ€§åˆ†ç±»ç³»ç»Ÿï¼Œä½¿ç”¨æ”¹è¿›çš„ SqueezeNet + Ghost Module ç½‘ç»œæ¶æ„ï¼Œç”¨äºè¯†åˆ«ç‰ç±³ç²’æ˜¯å¦å®Œæ•´ï¼ˆintactï¼‰æˆ–ç ´æŸï¼ˆbrokenï¼‰ã€‚

## é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªè½»é‡çº§çš„å›¾åƒåˆ†ç±»æ¨¡å‹ï¼Œä¸“é—¨ç”¨äºç‰ç±³ç²’çš„è´¨é‡æ£€æµ‹ã€‚æ¨¡å‹åŸºäº SqueezeNet æ¶æ„å¹¶ç»“åˆ Ghost Module è¿›è¡Œä¼˜åŒ–ï¼Œåœ¨ä¿æŒé«˜å‡†ç¡®ç‡çš„åŒæ—¶å‡å°‘è®¡ç®—èµ„æºæ¶ˆè€—ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸŒ½ **äºŒåˆ†ç±»ä»»åŠ¡**ï¼šè¯†åˆ«å®Œæ•´ï¼ˆintactï¼‰å’Œç ´æŸï¼ˆbrokenï¼‰çš„ç‰ç±³ç²’
- ğŸš€ **è½»é‡çº§æ¨¡å‹**ï¼šåŸºäº SqueezeNet + Ghost Module ä¼˜åŒ–
- ğŸ“Š **å®Œæ•´çš„è®­ç»ƒæµç¨‹**ï¼šæ”¯æŒè®­ç»ƒã€éªŒè¯ã€æµ‹è¯•å…¨æµç¨‹
- ğŸ“ˆ **è¯¦ç»†çš„è¯„ä¼°æŒ‡æ ‡**ï¼šå‡†ç¡®ç‡ã€ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-scoreã€æ··æ·†çŸ©é˜µ
- ğŸ”® **çµæ´»çš„é¢„æµ‹åŠŸèƒ½**ï¼šæ”¯æŒå•å¼ å›¾ç‰‡å’Œæ‰¹é‡é¢„æµ‹
- ğŸ“ **æ—¥å¿—è®°å½•**ï¼šè‡ªåŠ¨ä¿å­˜è®­ç»ƒæ—¥å¿—å’Œæ¨¡å‹æ£€æŸ¥ç‚¹

## é¡¹ç›®ç»“æ„

```
CornProject/
â”œâ”€â”€ config. py              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ train.py              # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ evaluate.py           # è¯„ä¼°è„šæœ¬
â”œâ”€â”€ predict.py            # é¢„æµ‹è„šæœ¬
â”œâ”€â”€ requirements.txt      # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ models/              
â”‚   â””â”€â”€ squeezenet_ghost.py  # æ¨¡å‹æ¶æ„
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ augmentation. py   # æ•°æ®å¢å¼º
â”‚   â”œâ”€â”€ data_loader.py    # æ•°æ®åŠ è½½å™¨
â”‚   â””â”€â”€ metrics.py        # è¯„ä¼°æŒ‡æ ‡
â”œâ”€â”€ data/                 # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ train/           # è®­ç»ƒé›†
â”‚   â”œâ”€â”€ val/             # éªŒè¯é›†
â”‚   â””â”€â”€ test/            # æµ‹è¯•é›†
â”œâ”€â”€ checkpoints/         # æ¨¡å‹ä¿å­˜ç›®å½•
â””â”€â”€ logs/                # æ—¥å¿—ä¿å­˜ç›®å½•
```

## ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- CUDA 11.0+ (å¦‚æœä½¿ç”¨ GPU)

### å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Jie-Huangi/CornProject.git
cd CornProject

# å®‰è£…ä¾èµ–åŒ…
pip install -r requirements.txt
```

### ä¾èµ–åŒ…æ¸…å•

- torch >= 2.0.0
- torchvision >= 0. 15.0
- numpy >= 1.24.0
- opencv-python >= 4.7. 0
- Pillow >= 9.5.0
- scikit-learn >= 1.2.0
- matplotlib >= 3.7.0
- tqdm >= 4.65.0

## æ•°æ®å‡†å¤‡

### æ•°æ®é›†ç»“æ„

æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡æ‚¨çš„æ•°æ®é›†ï¼š

```
data/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ intact/          # å®Œæ•´ç‰ç±³ç²’å›¾ç‰‡
â”‚   â””â”€â”€ broken/          # ç ´æŸç‰ç±³ç²’å›¾ç‰‡
â”œâ”€â”€ val/
â”‚   â”œâ”€â”€ intact/
â”‚   â””â”€â”€ broken/
â””â”€â”€ test/
    â”œâ”€â”€ intact/
    â””â”€â”€ broken/
```

### æ•°æ®æ ¼å¼

- æ”¯æŒçš„å›¾ç‰‡æ ¼å¼ï¼š`. jpg`, `.png`
- å›¾ç‰‡ä¼šè‡ªåŠ¨è°ƒæ•´ä¸º 224x224 å°ºå¯¸
- è®­ç»ƒæ—¶ä¼šè‡ªåŠ¨åº”ç”¨æ•°æ®å¢å¼º

## ä½¿ç”¨æ–¹æ³•

### 1. é…ç½®å‚æ•°

ç¼–è¾‘ `config.py` æ–‡ä»¶ï¼Œæ ¹æ®éœ€è¦è°ƒæ•´é…ç½®ï¼š

```python
# æ•°æ®é…ç½®
DATA_CONFIG = {
    'train_path': DATA_DIR / 'train',
    'val_path': DATA_DIR / 'val',
    'test_path': DATA_DIR / 'test',
    'image_size': 224,
    'batch_size': 32,
    'num_workers': 4,
}

# è®­ç»ƒé…ç½®
TRAIN_CONFIG = {
    'num_epochs': 100,
    'learning_rate': 0.001,
    'weight_decay': 1e-4,
    'dropout': 0.5,
    'num_classes': 2,
    'device': 'cuda',  # ä½¿ç”¨ 'cpu' å¦‚æœæ²¡æœ‰ GPU
}
```

### 2. è®­ç»ƒæ¨¡å‹

```bash
python train.py
```

**è®­ç»ƒè¿‡ç¨‹ä¼šï¼š**
- è‡ªåŠ¨åˆ›å»º `checkpoints/` å’Œ `logs/` ç›®å½•
- æ˜¾ç¤ºå®æ—¶è®­ç»ƒè¿›åº¦å’ŒæŒ‡æ ‡
- ä¿å­˜æœ€ä½³æ¨¡å‹åˆ° `checkpoints/best_model.pth`
- ä¿å­˜æœ€åä¸€æ¬¡è®­ç»ƒæ£€æŸ¥ç‚¹åˆ° `checkpoints/last_checkpoint.pth`
- ç”Ÿæˆè®­ç»ƒå†å²è®°å½• `logs/training_history.json`
- è®°å½•è¯¦ç»†æ—¥å¿—åˆ° `logs/training. log`

**è®­ç»ƒè¾“å‡ºç¤ºä¾‹ï¼š**
```
Epoch 1/100 [Train]: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 50/50 [00:30<00:00, loss: 0.6234, acc: 0.7123]
Epoch 1/100 [Val]: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 10/10 [00:05<00:00, acc: 0.7500]
Train Loss: 0.6234, Train Acc: 0.7123
Val Acc: 0.7500, Precision: 0.7345, Recall: 0.7621, F1: 0.7481
Best model saved with accuracy: 0.7500
```

### 3. è¯„ä¼°æ¨¡å‹

åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°è®­ç»ƒå¥½çš„æ¨¡å‹ï¼š

```bash
python evaluate.py
```

**è¯„ä¼°ä¼šç”Ÿæˆï¼š**
- æµ‹è¯•é›†å‡†ç¡®ç‡ã€ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-score
- è¯¦ç»†çš„åˆ†ç±»æŠ¥å‘Š
- æ··æ·†çŸ©é˜µå›¾ `logs/confusion_matrix.png`
- æŒ‡æ ‡å¯è§†åŒ–å›¾ `logs/metrics. png`

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
==================================================
Test Results
==================================================
Accuracy: 0.8945
Precision: 0.8876
Recall: 0.9021
F1-Score: 0.8948

Classification Report:
              precision    recall  f1-score   support
      intact       0.91      0.88      0.89       150
      broken       0.87      0.90      0.88       145
    accuracy                           0.89       295
```

### 4. é¢„æµ‹

#### å•å¼ å›¾ç‰‡é¢„æµ‹

```python
from predict import Predictor
import config

# åˆ›å»ºé¢„æµ‹å™¨
predictor = Predictor(
    checkpoint_path=config.CHECKPOINT_PATH,
    device='cuda'  # æˆ– 'cpu'
)

# é¢„æµ‹å•å¼ å›¾ç‰‡
class_name, confidence, all_probs = predictor.predict_image('path/to/image.jpg')
print(f"é¢„æµ‹ç±»åˆ«: {class_name}")
print(f"ç½®ä¿¡åº¦: {confidence:. 4f}")
print(f"æ‰€æœ‰æ¦‚ç‡: {all_probs}")
```

#### æ‰¹é‡é¢„æµ‹

```python
# é¢„æµ‹æ•´ä¸ªæ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡
results = predictor.predict_batch('path/to/image/directory', save_results=True)
# ç»“æœä¼šä¿å­˜åˆ° logs/predictions.json
```

#### å¯è§†åŒ–é¢„æµ‹ç»“æœ

```python
# åœ¨å›¾ç‰‡ä¸Šå¯è§†åŒ–é¢„æµ‹ç»“æœ
predictor.visualize_prediction(
    image_path='path/to/image.jpg',
    save_path='output. jpg'
)
```

#### å‘½ä»¤è¡Œé¢„æµ‹

ç›´æ¥è¿è¡Œé¢„æµ‹è„šæœ¬ï¼ˆéœ€è¦å…ˆä¿®æ”¹ `predict.py` ä¸­çš„ç¤ºä¾‹å›¾ç‰‡è·¯å¾„ï¼‰ï¼š

```bash
python predict.py
```

## æ¨¡å‹æ¶æ„

æœ¬é¡¹ç›®ä½¿ç”¨æ”¹è¿›çš„ SqueezeNet æ¶æ„ï¼š

- **åŸºç¡€æ¶æ„**ï¼šSqueezeNet 1.1
- **æ”¹è¿›æ¨¡å—**ï¼šGhost Moduleï¼ˆå‡å°‘å‚æ•°é‡å’Œè®¡ç®—é‡ï¼‰
- **åˆ†ç±»å™¨**ï¼šå…¨è¿æ¥å±‚ + Dropout + Softmax
- **å‚æ•°é‡**ï¼šçº¦ 1.2Mï¼ˆç›¸æ¯”åŸå§‹ç½‘ç»œå‡å°‘çº¦ 30%ï¼‰

## æ€§èƒ½ä¼˜åŒ–

### æ•°æ®å¢å¼º

è®­ç»ƒæ—¶è‡ªåŠ¨åº”ç”¨ä»¥ä¸‹å¢å¼ºæ–¹æ³•ï¼š
- éšæœºæ°´å¹³ç¿»è½¬
- éšæœºæ—‹è½¬ï¼ˆÂ±15Â°ï¼‰
- é¢œè‰²æŠ–åŠ¨ï¼ˆäº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦ã€è‰²è°ƒï¼‰
- éšæœºè°ƒæ•´å°ºå¯¸å’Œè£å‰ª
- å½’ä¸€åŒ–ï¼ˆImageNet ç»Ÿè®¡å€¼ï¼‰

### å­¦ä¹ ç‡è°ƒåº¦

ä½¿ç”¨ `ReduceLROnPlateau` ç­–ç•¥ï¼š
- éªŒè¯å‡†ç¡®ç‡ 10 ä¸ª epoch ä¸æå‡æ—¶ï¼Œå­¦ä¹ ç‡å‡åŠ
- å¸®åŠ©æ¨¡å‹è·³å‡ºå±€éƒ¨æœ€ä¼˜

### æ—©åœæœºåˆ¶

è‡ªåŠ¨ä¿å­˜éªŒè¯é›†ä¸Šè¡¨ç°æœ€å¥½çš„æ¨¡å‹

## å¸¸è§é—®é¢˜

### 1.  CUDA Out of Memory

é™ä½ `batch_size` åœ¨ `config.py` ä¸­ï¼š
```python
DATA_CONFIG = {
    'batch_size': 16,  # ä» 32 é™ä½åˆ° 16
}
```

### 2. è®­ç»ƒé€Ÿåº¦æ…¢

- ç¡®ä¿ä½¿ç”¨ GPUï¼š`device='cuda'`
- å¢åŠ  `num_workers` ç”¨äºæ•°æ®åŠ è½½
- å‡å°‘ `image_size` å¦‚æœç²¾åº¦è¦æ±‚ä¸é«˜

### 3.  æ¨¡å‹è¿‡æ‹Ÿåˆ

- å¢åŠ  `dropout` å€¼ï¼ˆå¦‚ 0.6-0.7ï¼‰
- å¢åŠ  `weight_decay`ï¼ˆå¦‚ 1e-3ï¼‰
- æ”¶é›†æ›´å¤šè®­ç»ƒæ•°æ®
- å¢å¼ºæ•°æ®å¢å¼ºç­–ç•¥

### 4. æ‰¾ä¸åˆ°æ•°æ®é›†

ç¡®ä¿æ•°æ®é›†è·¯å¾„æ­£ç¡®ï¼Œæˆ–åœ¨ `config.py` ä¸­ä¿®æ”¹ï¼š
```python
DATA_DIR = Path("your/custom/data/path")
```

## è¾“å‡ºæ–‡ä»¶è¯´æ˜

### checkpoints/
- `best_model.pth`: éªŒè¯é›†ä¸Šè¡¨ç°æœ€å¥½çš„æ¨¡å‹
- `last_checkpoint.pth`: æœ€åä¸€ä¸ª epoch çš„æ£€æŸ¥ç‚¹

### logs/
- `training. log`: è®­ç»ƒè¿‡ç¨‹æ—¥å¿—
- `training_history. json`: è®­ç»ƒå†å²æ•°æ®ï¼ˆlossã€acc ç­‰ï¼‰
- `confusion_matrix.png`: æ··æ·†çŸ©é˜µå¯è§†åŒ–
- `metrics.png`: è¯„ä¼°æŒ‡æ ‡å¯è§†åŒ–
- `predictions.json`: æ‰¹é‡é¢„æµ‹ç»“æœ

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·åœ¨ GitHub ä¸Šæäº¤ Issueã€‚

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸŒ½**